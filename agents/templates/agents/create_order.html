{% extends 'agents/base.html' %}

{% block title %}–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞{% endblock %}

{% block content %}
<style>
    .order-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .order-form {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #1e5799;
    }
    
    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
    }
    
    .form-control:focus {
        border-color: #207cca;
        outline: none;
        box-shadow: 0 0 5px rgba(32, 124, 202, 0.3);
    }
    
    .submit-btn {
        background: linear-gradient(135deg, #1e5799 0%, #207cca 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
        margin-right: 10px;
    }
    
    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(32, 124, 202, 0.4);
    }
    
    .email-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        margin-left: 10px;
    }
    
    .email-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        color: white;
        text-decoration: none;
    }
    
    .button-group {
        text-align: center;
        margin-top: 30px;
    }
</style>

<div class="order-container">
    <h1 style="text-align: center; margin-bottom: 30px; color: #1e5799;">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞</h1>
    
    <div class="order-form">
        <form method="post" id="orderForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ form.customer_name.id_for_label }}">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:</label>
                {{ form.customer_name }}
                {% if form.customer_name.errors %}
                <div style="color: red; font-size: 14px; margin-top: 5px;">
                    {{ form.customer_name.errors }}
                </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.customer_phone.id_for_label }}">–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞:</label>
                {{ form.customer_phone }}
                {% if form.customer_phone.errors %}
                <div style="color: red; font-size: 14px; margin-top: 5px;">
                    {{ form.customer_phone.errors }}
                </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.customer_email.id_for_label }}">Email –∫–ª–∏–µ–Ω—Ç–∞:</label>
                {{ form.customer_email }}
                {% if form.customer_email.errors %}
                <div style="color: red; font-size: 14px; margin-top: 5px;">
                    {{ form.customer_email.errors }}
                </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.notes.id_for_label }}">–ó–∞–∫–∞–∑:</label>
                {{ form.notes }}
                {% if form.notes.errors %}
                <div style="color: red; font-size: 14px; margin-top: 5px;">
                    {{ form.notes.errors }}
                </div>
                {% endif %}
            </div>
            
            <div class="button-group">
                <button type="submit" class="submit-btn">üìã –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ email -->
                <button type="button" class="email-btn" onclick="sendOrderByEmail()">
                    üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ –ø–æ—á—Ç–µ
                </button>
                
                <div style="margin-top: 15px;">
                    <a href="{% url 'order_list' %}" style="color: #6c757d; text-decoration: none;">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function sendOrderByEmail() {
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
        const customerName = document.querySelector('#id_customer_name').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
        const customerPhone = document.querySelector('#id_customer_phone').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
        const customerEmail = document.querySelector('#id_customer_email').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
        const notes = document.querySelector('#id_notes').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
        
        // Email –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π)
        const recipientEmail = 'orders@medtech.ru';
        
        // –¢–µ–º–∞ –ø–∏—Å—å–º–∞
        const subject = `–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ –æ—Ç –∞–≥–µ–Ω—Ç–∞ #{{ user.id }}`;
        
        // –¢–µ–∫—Å—Ç –ø–∏—Å—å–º–∞ —Å ID –∞–≥–µ–Ω—Ç–∞
        const body = `
    –ù–û–í–´–ô –ó–ê–ö–ê–ó
    
    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≥–µ–Ω—Ç–µ:
    –ê–≥–µ–Ω—Ç ID: {{ user.id }}
    –ò–º—è –∞–≥–µ–Ω—Ç–∞: {{ user.username }}
    {% if user.first_name or user.last_name %}
    –§–ò–û –∞–≥–µ–Ω—Ç–∞: {{ user.first_name }} {{ user.last_name }}
    {% endif %}
    
    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ:
    –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: ${customerName}
    –¢–µ–ª–µ—Ñ–æ–Ω: ${customerPhone}
    Email: ${customerEmail}
    
    –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞:
    ${notes}
    
    ---
    –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${new Date().toLocaleString()}
        `.trim();
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º mailto —Å—Å—ã–ª–∫—É
        const mailtoLink = `mailto:${recipientEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—á—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
        window.location.href = mailtoLink;
    }
    </script>
    
{% endblock %}